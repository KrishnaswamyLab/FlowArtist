---

title: 03c02 Flow Neighbor MSE


keywords: fastai
sidebar: home_sidebar



nb_path: "03 Model and Loss Functions/03c02 Flow Neighbor MSE.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 03 Model and Loss Functions/03c02 Flow Neighbor MSE.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="flow_neighbor_loss" class="doc_header"><code>flow_neighbor_loss</code><a href="https://github.com/professorwug/FRED/tree/master/FRED/embed.py#L236" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>flow_neighbor_loss</code>(<strong><code>neighbors</code></strong>, <strong><code>embedded_points</code></strong>, <strong><code>embedded_flows</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="contrastive_flow_loss" class="doc_header"><code>contrastive_flow_loss</code><a href="https://github.com/professorwug/FRED/tree/master/FRED/embed.py#L244" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>contrastive_flow_loss</code>(<strong><code>not_neighbors</code></strong>, <strong><code>embedded_points</code></strong>, <strong><code>embedded_flows</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="contrastive_flow_loss_V2" class="doc_header"><code>contrastive_flow_loss_V2</code><a href="https://github.com/professorwug/FRED/tree/master/FRED/embed.py#L255" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>contrastive_flow_loss_V2</code>(<strong><code>embedded_points</code></strong>, <strong><code>embedded_flows</code></strong>, <strong><code>neighbors</code></strong>, <strong><code>use_distance_kernel</code></strong>=<em><code>False</code></em>, <strong><code>debug</code></strong>=<em><code>False</code></em>, <strong><code>only_optimize_flow_artist</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>embedded_points</code></strong></td>
<td></td>
<td></td>
<td>a batch of embedded points</td>
</tr>
<tr>
<td><strong><code>embedded_flows</code></strong></td>
<td></td>
<td></td>
<td>the flows associated to each embedded point</td>
</tr>
<tr>
<td><strong><code>neighbors</code></strong></td>
<td></td>
<td></td>
<td>a list of size batch_size/2, mapping point i in the batch to its neighbor in the batch, neighbor[i]</td>
</tr>
<tr>
<td><strong><code>use_distance_kernel</code></strong></td>
<td><code>bool</code></td>
<td><code>False</code></td>
<td><em>No Content</em></td>
</tr>
<tr>
<td><strong><code>debug</code></strong></td>
<td><code>bool</code></td>
<td><code>False</code></td>
<td><em>No Content</em></td>
</tr>
<tr>
<td><strong><code>only_optimize_flow_artist</code></strong></td>
<td><code>bool</code></td>
<td><code>True</code></td>
<td><em>No Content</em></td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Experimental-validation">Experimental validation<a class="anchor-link" href="#Experimental-validation"> </a></h2><p>Is the flow contrastive loss minimized when each arrow is pointing to its neighbor?</p>
<p>Here's the loss with the arrows pointing to the direct neighbors:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">16</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">FRED.datasets</span> <span class="kn">import</span> <span class="n">directed_circle</span><span class="p">,</span><span class="n">plot_directed_2d</span>
<span class="n">X</span><span class="p">,</span> <span class="n">flows</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">directed_circle</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="n">batch_size</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">flows</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">flows</span><span class="p">)</span>
<span class="n">plot_directed_2d</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">flows</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">arrow_scale</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">mask_prob</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_svg output_subarea ">
<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
  "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="271.200122pt" height="248.518125pt" viewBox="0 0 271.200122 248.518125" xmlns="http://www.w3.org/2000/svg" version="1.1">
 <metadata>
  <rdf:RDF xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
   <cc:Work>
    <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/>
    <dc:date>2022-12-24T05:49:13.811277</dc:date>
    <dc:format>image/svg+xml</dc:format>
    <dc:creator>
     <cc:Agent>
      <dc:title>Matplotlib v3.5.2, https://matplotlib.org/</dc:title>
     </cc:Agent>
    </dc:creator>
   </cc:Work>
  </rdf:RDF>
 </metadata>
 <defs>
  <style type="text/css">*{stroke-linejoin: round; stroke-linecap: butt}</style>
 </defs>
 <g id="figure_1">
  <g id="patch_1">
   <path d="M 0 248.518125 
L 271.200122 248.518125 
L 271.200122 0 
L 0 0 
L 0 248.518125 
z
" style="fill: none"/>
  </g>
  <g id="axes_1">
   <g id="patch_2">
    <path d="M 44.845313 224.64 
L 264.000122 224.64 
L 264.000122 7.2 
L 44.845313 7.2 
z
" style="fill: #ffffff"/>
   </g>
   <g id="PathCollection_1">
    <defs>
     <path id="C0_0_a5f2432818" d="M 0 1.5 
C 0.397805 1.5 0.77937 1.341951 1.06066 1.06066 
C 1.341951 0.77937 1.5 0.397805 1.5 -0 
C 1.5 -0.397805 1.341951 -0.77937 1.06066 -1.06066 
C 0.77937 -1.341951 0.397805 -1.5 0 -1.5 
C -0.397805 -1.5 -0.77937 -1.341951 -1.06066 -1.06066 
C -1.341951 -0.77937 -1.5 -0.397805 -1.5 0 
C -1.5 0.397805 -1.341951 0.77937 -1.06066 1.06066 
C -0.77937 1.341951 -0.397805 1.5 0 1.5 
z
"/>
    </defs>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="253.733985" y="107.525494" style="fill: #440154; stroke: #440154"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="252.717983" y="99.460719" style="fill: #450559; stroke: #450559"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="249.081989" y="84.731194" style="fill: #470e61; stroke: #470e61"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="248.445591" y="82.860446" style="fill: #471063; stroke: #471063"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="237.842414" y="61.355439" style="fill: #481d6f; stroke: #481d6f"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="213.270625" y="35.407888" style="fill: #46307e; stroke: #46307e"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="194.523341" y="24.568512" style="fill: #443b84; stroke: #443b84"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="174.279951" y="18.104456" style="fill: #404688; stroke: #404688"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="139.93482" y="17.083636" style="fill: #39558c; stroke: #39558c"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="128.872459" y="19.321702" style="fill: #375b8d; stroke: #375b8d"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="118.306962" y="22.726116" style="fill: #355f8d; stroke: #355f8d"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="104.127044" y="29.506661" style="fill: #31668e; stroke: #31668e"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="83.267576" y="45.595927" style="fill: #2d718e; stroke: #2d718e"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="61.1066" y="79.661479" style="fill: #26818e; stroke: #26818e"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="58.650186" y="86.729416" style="fill: #25838e; stroke: #25838e"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="54.806895" y="126.263577" style="fill: #20938c; stroke: #20938c"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="56.952281" y="138.943247" style="fill: #1f988b; stroke: #1f988b"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="62.533062" y="155.743026" style="fill: #1f9f88; stroke: #1f9f88"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="68.889679" y="167.995684" style="fill: #20a486; stroke: #20a486"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="78.028397" y="180.639307" style="fill: #25ab82; stroke: #25ab82"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="79.289043" y="182.095189" style="fill: #25ab82; stroke: #25ab82"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="80.368122" y="183.297641" style="fill: #25ac82; stroke: #25ac82"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="85.442703" y="188.471231" style="fill: #28ae80; stroke: #28ae80"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="139.250431" y="214.756364" style="fill: #50c46a; stroke: #50c46a"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="184.094138" y="211.296195" style="fill: #7ad151; stroke: #7ad151"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="208.394294" y="199.892005" style="fill: #95d840; stroke: #95d840"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="219.998168" y="191.137356" style="fill: #a5db36; stroke: #a5db36"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="221.790902" y="189.529085" style="fill: #a8db34; stroke: #a8db34"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="236.925385" y="171.965171" style="fill: #c2df23; stroke: #c2df23"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="238.980419" y="168.801407" style="fill: #c8e020; stroke: #c8e020"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="253.476768" y="127.036882" style="fill: #f6e620; stroke: #f6e620"/>
    </g>
    <g clip-path="url(#pa205b84175)">
     <use xlink:href="#C0_0_a5f2432818" x="254.03854" y="119.224517" style="fill: #fde725; stroke: #fde725"/>
    </g>
   </g>
   <g id="Quiver_1">
    <path d="M 252.915096 107.594962 
L 251.224718 87.668655 
L 249.656407 88.62648 
L 251.418399 80.229184 
L 254.569743 88.209674 
L 252.862497 87.52972 
L 254.552875 107.456027 
L 252.915096 107.594962 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 251.907451 99.596526 
L 248.602807 79.873586 
L 247.11755 80.955732 
L 248.191073 72.442992 
L 251.980741 80.140888 
L 250.22387 79.601971 
L 253.528515 99.324912 
L 251.907451 99.596526 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 248.301366 84.988165 
L 242.048421 65.993014 
L 240.744147 67.287578 
L 240.516311 58.71044 
L 245.427882 65.745756 
L 243.609667 65.479074 
L 249.862611 84.474224 
L 248.301366 84.988165 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 247.670203 83.132805 
L 241.042805 64.265038 
L 239.764388 65.585143 
L 239.366963 57.01419 
L 244.416714 63.95099 
L 242.59358 63.72032 
L 249.220979 82.588087 
L 247.670203 83.132805 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 237.154247 61.804695 
L 226.222349 45.059287 
L 225.295271 46.645967 
L 222.867212 38.416524 
L 229.424275 43.95043 
L 227.598684 44.160775 
L 238.530582 60.906183 
L 237.154247 61.804695 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 212.784582 36.070585 
L 196.658954 24.243531 
L 196.349565 26.054968 
L 191.180724 19.206444 
L 199.265825 22.078786 
L 197.631041 22.918137 
L 213.756668 34.745191 
L 212.784582 36.070585 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 194.19151 25.320372 
L 175.896245 17.245824 
L 175.984444 19.081375 
L 169.461334 13.507487 
L 177.975428 14.570214 
L 176.559907 15.742104 
L 194.855172 23.816652 
L 194.19151 25.320372 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 174.11464 18.909489 
L 154.525512 14.88691 
L 154.999922 16.662287 
L 147.44553 12.594075 
L 155.991791 11.832091 
L 154.856135 13.276845 
L 174.445263 17.299423 
L 174.11464 18.909489 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 140.052027 17.897066 
L 120.258569 20.7491 
L 121.306413 22.258752 
L 112.820494 20.990532 
L 120.603171 17.378174 
L 120.024155 19.12224 
L 139.817613 16.270207 
L 140.052027 17.897066 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 129.080663 20.116722 
L 109.735182 25.183027 
L 110.946611 26.564862 
L 102.3718 26.261846 
L 109.697385 21.794743 
L 109.318774 23.592987 
L 128.664254 18.526682 
L 129.080663 20.116722 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 118.602077 23.493131 
L 99.938033 30.674254 
L 101.295278 31.91317 
L 92.739779 32.56327 
L 99.52459 27.311077 
L 99.347804 29.140223 
L 118.011848 21.9591 
L 118.602077 23.493131 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 104.538801 30.217901 
L 87.231969 40.237313 
L 88.766722 41.248036 
L 80.419055 43.231883 
L 86.296182 36.980597 
L 86.408455 38.814833 
L 103.715288 28.795422 
L 104.538801 30.217901 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 83.850919 46.174819 
L 69.764557 60.369517 
L 71.510136 60.943956 
L 63.971189 65.040719 
L 68.010074 57.470607 
L 68.597869 59.211733 
L 82.684232 45.017036 
L 83.850919 46.174819 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 61.872237 79.960152 
L 54.604525 98.590649 
L 56.434471 98.422358 
L 51.15083 105.182708 
L 51.84065 96.63032 
L 53.073251 97.993303 
L 60.340963 79.362806 
L 61.872237 79.960152 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 59.436029 86.969949 
L 53.583054 106.092128 
L 55.395273 105.787352 
L 50.632412 112.924182 
L 50.680215 104.344152 
L 52.011368 105.611062 
L 57.864343 86.488882 
L 59.436029 86.969949 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 55.624352 126.178908 
L 57.684638 146.07037 
L 59.234884 145.083574 
L 57.629204 153.512156 
L 54.330139 145.59159 
L 56.049723 146.239709 
L 53.989437 126.348246 
L 55.624352 126.178908 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 57.75209 138.754276 
L 62.350372 158.216313 
L 63.761021 157.038562 
L 63.251297 165.603571 
L 58.962163 158.172385 
L 60.750753 158.594254 
L 56.152471 139.132217 
L 57.75209 138.754276 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 63.286965 155.415863 
L 71.247935 173.760836 
L 72.428578 172.352606 
L 73.438501 180.873126 
L 67.90516 174.315585 
L 69.740129 174.415162 
L 61.779159 156.07019 
L 63.286965 155.415863 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 69.591293 167.567732 
L 80.004787 184.640347 
L 80.980064 183.082829 
L 83.154739 191.382828 
L 76.770378 185.65054 
L 78.601558 185.496251 
L 68.188064 168.423635 
L 69.591293 167.567732 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 78.654837 180.10735 
L 91.599112 195.350736 
L 92.320037 193.660382 
L 95.76028 201.520657 
L 88.561394 196.852121 
L 90.346231 196.414649 
L 77.401956 181.171263 
L 78.654837 180.10735 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 79.905114 181.551256 
L 93.140802 196.542308 
L 93.829011 194.838372 
L 97.420123 202.630876 
L 90.132587 198.101967 
L 91.908661 197.630173 
L 78.672973 182.639121 
L 79.905114 181.551256 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 80.975316 182.743818 
L 94.451691 197.518878 
L 95.112255 195.804036 
L 98.828909 203.53745 
L 91.46909 199.126978 
L 93.237302 198.626525 
L 79.760928 183.851465 
L 80.975316 182.743818 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 86.008154 187.87485 
L 100.520088 201.634169 
L 101.05461 199.875955 
L 105.322064 207.319612 
L 97.661901 203.45424 
L 99.389185 202.82693 
L 84.877251 189.067611 
L 86.008154 187.87485 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 139.373268 213.943765 
L 159.146502 216.932787 
L 158.579577 215.184754 
L 166.337054 218.850915 
L 157.842558 220.060346 
L 158.900829 218.557985 
L 139.127595 215.568962 
L 139.373268 213.943765 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 183.848096 210.512059 
L 202.928735 204.525048 
L 201.652516 203.202818 
L 210.231998 203.094809 
L 203.128765 207.907633 
L 203.420818 206.093319 
L 184.34018 212.080331 
L 183.848096 210.512059 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 207.948363 199.201679 
L 224.746308 188.350684 
L 223.164119 187.415962 
L 231.405179 185.027629 
L 225.839707 191.557922 
L 225.638171 189.731337 
L 208.840226 200.582332 
L 207.948363 199.201679 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 219.456785 190.519044 
L 234.502377 177.345387 
L 232.801298 176.650146 
L 240.608568 173.091251 
L 236.049597 180.360018 
L 235.585143 178.582011 
L 220.539551 191.755668 
L 219.456785 190.519044 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 221.234772 188.924003 
L 235.958448 175.391508 
L 234.241106 174.737472 
L 241.960322 170.991421 
L 237.577886 178.367968 
L 237.070708 176.601673 
L 222.347032 190.134168 
L 221.234772 188.924003 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 236.244761 171.504566 
L 247.452798 154.942714 
L 245.630946 154.702129 
L 252.278861 149.277701 
L 249.71469 157.465755 
L 248.814046 155.863922 
L 237.606009 172.425775 
L 236.244761 171.504566 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 238.28289 168.366828 
L 248.85766 151.393634 
L 247.028023 151.222004 
L 253.466405 145.550457 
L 251.213194 153.829481 
L 250.252717 152.262793 
L 239.677947 169.235987 
L 238.28289 168.366828 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 252.659995 126.945851 
L 254.875068 107.07103 
L 253.15049 107.705743 
L 256.511114 99.811099 
L 258.051131 108.251925 
L 256.508615 107.253091 
L 254.293542 127.127912 
L 252.659995 126.945851 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
    <path d="M 253.217145 119.19775 
L 253.868474 99.210483 
L 252.198918 99.978344 
L 254.930772 91.844699 
L 257.127286 100.138946 
L 255.511263 99.264017 
L 254.859934 119.251284 
L 253.217145 119.19775 
" clip-path="url(#pa205b84175)" style="fill-opacity: 0.1"/>
   </g>
   <g id="matplotlib.axis_1">
    <g id="xtick_1">
     <g id="line2d_1">
      <defs>
       <path id="mbbb03b46c0" d="M 0 0 
L 0 3.5 
" style="stroke: #000000; stroke-width: 0.8"/>
      </defs>
      <g>
       <use xlink:href="#mbbb03b46c0" x="54.275258" y="224.64" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_1">
      <!-- −1.0 -->
      <g transform="translate(42.133852 239.238437)scale(0.1 -0.1)">
       <defs>
        <path id="DejaVuSans-2212" d="M 678 2272 
L 4684 2272 
L 4684 1741 
L 678 1741 
L 678 2272 
z
" transform="scale(0.015625)"/>
        <path id="DejaVuSans-31" d="M 794 531 
L 1825 531 
L 1825 4091 
L 703 3866 
L 703 4441 
L 1819 4666 
L 2450 4666 
L 2450 531 
L 3481 531 
L 3481 0 
L 794 0 
L 794 531 
z
" transform="scale(0.015625)"/>
        <path id="DejaVuSans-2e" d="M 684 794 
L 1344 794 
L 1344 0 
L 684 0 
L 684 794 
z
" transform="scale(0.015625)"/>
        <path id="DejaVuSans-30" d="M 2034 4250 
Q 1547 4250 1301 3770 
Q 1056 3291 1056 2328 
Q 1056 1369 1301 889 
Q 1547 409 2034 409 
Q 2525 409 2770 889 
Q 3016 1369 3016 2328 
Q 3016 3291 2770 3770 
Q 2525 4250 2034 4250 
z
M 2034 4750 
Q 2819 4750 3233 4129 
Q 3647 3509 3647 2328 
Q 3647 1150 3233 529 
Q 2819 -91 2034 -91 
Q 1250 -91 836 529 
Q 422 1150 422 2328 
Q 422 3509 836 4129 
Q 1250 4750 2034 4750 
z
" transform="scale(0.015625)"/>
       </defs>
       <use xlink:href="#DejaVuSans-2212"/>
       <use xlink:href="#DejaVuSans-31" x="83.789062"/>
       <use xlink:href="#DejaVuSans-2e" x="147.412109"/>
       <use xlink:href="#DejaVuSans-30" x="179.199219"/>
      </g>
     </g>
    </g>
    <g id="xtick_2">
     <g id="line2d_2">
      <g>
       <use xlink:href="#mbbb03b46c0" x="104.22933" y="224.64" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_2">
      <!-- −0.5 -->
      <g transform="translate(92.087923 239.238437)scale(0.1 -0.1)">
       <defs>
        <path id="DejaVuSans-35" d="M 691 4666 
L 3169 4666 
L 3169 4134 
L 1269 4134 
L 1269 2991 
Q 1406 3038 1543 3061 
Q 1681 3084 1819 3084 
Q 2600 3084 3056 2656 
Q 3513 2228 3513 1497 
Q 3513 744 3044 326 
Q 2575 -91 1722 -91 
Q 1428 -91 1123 -41 
Q 819 9 494 109 
L 494 744 
Q 775 591 1075 516 
Q 1375 441 1709 441 
Q 2250 441 2565 725 
Q 2881 1009 2881 1497 
Q 2881 1984 2565 2268 
Q 2250 2553 1709 2553 
Q 1456 2553 1204 2497 
Q 953 2441 691 2322 
L 691 4666 
z
" transform="scale(0.015625)"/>
       </defs>
       <use xlink:href="#DejaVuSans-2212"/>
       <use xlink:href="#DejaVuSans-30" x="83.789062"/>
       <use xlink:href="#DejaVuSans-2e" x="147.412109"/>
       <use xlink:href="#DejaVuSans-35" x="179.199219"/>
      </g>
     </g>
    </g>
    <g id="xtick_3">
     <g id="line2d_3">
      <g>
       <use xlink:href="#mbbb03b46c0" x="154.183401" y="224.64" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_3">
      <!-- 0.0 -->
      <g transform="translate(146.231839 239.238437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-30"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-30" x="95.410156"/>
      </g>
     </g>
    </g>
    <g id="xtick_4">
     <g id="line2d_4">
      <g>
       <use xlink:href="#mbbb03b46c0" x="204.137473" y="224.64" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_4">
      <!-- 0.5 -->
      <g transform="translate(196.185911 239.238437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-30"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-35" x="95.410156"/>
      </g>
     </g>
    </g>
    <g id="xtick_5">
     <g id="line2d_5">
      <g>
       <use xlink:href="#mbbb03b46c0" x="254.091545" y="224.64" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_5">
      <!-- 1.0 -->
      <g transform="translate(246.139983 239.238437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-31"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-30" x="95.410156"/>
      </g>
     </g>
    </g>
   </g>
   <g id="matplotlib.axis_2">
    <g id="ytick_1">
     <g id="line2d_6">
      <defs>
       <path id="m3906936e90" d="M 0 0 
L -3.5 0 
" style="stroke: #000000; stroke-width: 0.8"/>
      </defs>
      <g>
       <use xlink:href="#m3906936e90" x="44.845313" y="215.87866" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_6">
      <!-- −1.00 -->
      <g transform="translate(7.2 219.677879)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-2212"/>
       <use xlink:href="#DejaVuSans-31" x="83.789062"/>
       <use xlink:href="#DejaVuSans-2e" x="147.412109"/>
       <use xlink:href="#DejaVuSans-30" x="179.199219"/>
       <use xlink:href="#DejaVuSans-30" x="242.822266"/>
      </g>
     </g>
    </g>
    <g id="ytick_2">
     <g id="line2d_7">
      <g>
       <use xlink:href="#m3906936e90" x="44.845313" y="190.901624" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_7">
      <!-- −0.75 -->
      <g transform="translate(7.2 194.700843)scale(0.1 -0.1)">
       <defs>
        <path id="DejaVuSans-37" d="M 525 4666 
L 3525 4666 
L 3525 4397 
L 1831 0 
L 1172 0 
L 2766 4134 
L 525 4134 
L 525 4666 
z
" transform="scale(0.015625)"/>
       </defs>
       <use xlink:href="#DejaVuSans-2212"/>
       <use xlink:href="#DejaVuSans-30" x="83.789062"/>
       <use xlink:href="#DejaVuSans-2e" x="147.412109"/>
       <use xlink:href="#DejaVuSans-37" x="179.199219"/>
       <use xlink:href="#DejaVuSans-35" x="242.822266"/>
      </g>
     </g>
    </g>
    <g id="ytick_3">
     <g id="line2d_8">
      <g>
       <use xlink:href="#m3906936e90" x="44.845313" y="165.924588" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_8">
      <!-- −0.50 -->
      <g transform="translate(7.2 169.723807)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-2212"/>
       <use xlink:href="#DejaVuSans-30" x="83.789062"/>
       <use xlink:href="#DejaVuSans-2e" x="147.412109"/>
       <use xlink:href="#DejaVuSans-35" x="179.199219"/>
       <use xlink:href="#DejaVuSans-30" x="242.822266"/>
      </g>
     </g>
    </g>
    <g id="ytick_4">
     <g id="line2d_9">
      <g>
       <use xlink:href="#m3906936e90" x="44.845313" y="140.947553" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_9">
      <!-- −0.25 -->
      <g transform="translate(7.2 144.746771)scale(0.1 -0.1)">
       <defs>
        <path id="DejaVuSans-32" d="M 1228 531 
L 3431 531 
L 3431 0 
L 469 0 
L 469 531 
Q 828 903 1448 1529 
Q 2069 2156 2228 2338 
Q 2531 2678 2651 2914 
Q 2772 3150 2772 3378 
Q 2772 3750 2511 3984 
Q 2250 4219 1831 4219 
Q 1534 4219 1204 4116 
Q 875 4013 500 3803 
L 500 4441 
Q 881 4594 1212 4672 
Q 1544 4750 1819 4750 
Q 2544 4750 2975 4387 
Q 3406 4025 3406 3419 
Q 3406 3131 3298 2873 
Q 3191 2616 2906 2266 
Q 2828 2175 2409 1742 
Q 1991 1309 1228 531 
z
" transform="scale(0.015625)"/>
       </defs>
       <use xlink:href="#DejaVuSans-2212"/>
       <use xlink:href="#DejaVuSans-30" x="83.789062"/>
       <use xlink:href="#DejaVuSans-2e" x="147.412109"/>
       <use xlink:href="#DejaVuSans-32" x="179.199219"/>
       <use xlink:href="#DejaVuSans-35" x="242.822266"/>
      </g>
     </g>
    </g>
    <g id="ytick_5">
     <g id="line2d_10">
      <g>
       <use xlink:href="#m3906936e90" x="44.845313" y="115.970517" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_10">
      <!-- 0.00 -->
      <g transform="translate(15.579688 119.769735)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-30"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-30" x="95.410156"/>
       <use xlink:href="#DejaVuSans-30" x="159.033203"/>
      </g>
     </g>
    </g>
    <g id="ytick_6">
     <g id="line2d_11">
      <g>
       <use xlink:href="#m3906936e90" x="44.845313" y="90.993481" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_11">
      <!-- 0.25 -->
      <g transform="translate(15.579688 94.792699)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-30"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-32" x="95.410156"/>
       <use xlink:href="#DejaVuSans-35" x="159.033203"/>
      </g>
     </g>
    </g>
    <g id="ytick_7">
     <g id="line2d_12">
      <g>
       <use xlink:href="#m3906936e90" x="44.845313" y="66.016445" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_12">
      <!-- 0.50 -->
      <g transform="translate(15.579688 69.815664)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-30"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-35" x="95.410156"/>
       <use xlink:href="#DejaVuSans-30" x="159.033203"/>
      </g>
     </g>
    </g>
    <g id="ytick_8">
     <g id="line2d_13">
      <g>
       <use xlink:href="#m3906936e90" x="44.845313" y="41.039409" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_13">
      <!-- 0.75 -->
      <g transform="translate(15.579688 44.838628)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-30"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-37" x="95.410156"/>
       <use xlink:href="#DejaVuSans-35" x="159.033203"/>
      </g>
     </g>
    </g>
    <g id="ytick_9">
     <g id="line2d_14">
      <g>
       <use xlink:href="#m3906936e90" x="44.845313" y="16.062373" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_14">
      <!-- 1.00 -->
      <g transform="translate(15.579688 19.861592)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-31"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-30" x="95.410156"/>
       <use xlink:href="#DejaVuSans-30" x="159.033203"/>
      </g>
     </g>
    </g>
   </g>
   <g id="patch_3">
    <path d="M 44.845313 224.64 
L 44.845313 7.2 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_4">
    <path d="M 264.000122 224.64 
L 264.000122 7.2 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_5">
    <path d="M 44.845313 224.64 
L 264.000122 224.64 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_6">
    <path d="M 44.845313 7.2 
L 264.000122 7.2 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
  </g>
 </g>
 <defs>
  <clipPath id="pa205b84175">
   <rect x="44.845313" y="7.2" width="219.154809" height="217.44"/>
  </clipPath>
 </defs>
</svg>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">neighbors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">contrastive_flow_loss_V2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">flows</span><span class="p">,</span><span class="n">neighbors</span><span class="p">,</span><span class="n">use_distance_kernel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;optimal loss is&quot;</span><span class="p">,</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="n">neighbors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">contrastive_flow_loss_V2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="o">-</span><span class="n">flows</span><span class="p">,</span><span class="n">neighbors</span><span class="p">,</span><span class="n">use_distance_kernel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loss with arrows pointing the opposite direction is&quot;</span><span class="p">,</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="n">neighbors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="n">flows_t</span> <span class="o">=</span> <span class="n">flows</span>
<span class="n">flow_p</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">flows_t</span><span class="p">)</span>
<span class="n">flow_p</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">flows_t</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">flow_p</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">flows_t</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">flow_p</span> <span class="o">=</span> <span class="o">-</span><span class="n">flow_p</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">contrastive_flow_loss_V2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">flow_p</span><span class="p">,</span><span class="n">neighbors</span><span class="p">,</span><span class="n">use_distance_kernel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loss with arrows perpendicular to points&quot;</span><span class="p">,</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="n">neighbors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">contrastive_flow_loss_V2</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="n">flows</span><span class="p">,</span><span class="n">neighbors</span><span class="p">,</span><span class="n">use_distance_kernel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;optimal loss without distance kernel&quot;</span><span class="p">,</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="n">neighbors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">contrastive_flow_loss_V2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="o">-</span><span class="n">flows</span><span class="p">,</span><span class="n">neighbors</span><span class="p">,</span><span class="n">use_distance_kernel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loss with arrows pointing the opposite direction (without distance kernel) is&quot;</span><span class="p">,</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="n">neighbors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="n">flows_t</span> <span class="o">=</span> <span class="n">flows</span>
<span class="n">flow_p</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">flows_t</span><span class="p">)</span>
<span class="n">flow_p</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">flows_t</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">flow_p</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">flows_t</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">flow_p</span> <span class="o">=</span> <span class="o">-</span><span class="n">flow_p</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">contrastive_flow_loss_V2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">flow_p</span><span class="p">,</span><span class="n">neighbors</span><span class="p">,</span><span class="n">use_distance_kernel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loss with arrows perpendicular to points (without distance kernel) is &quot;</span><span class="p">,</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>optimal loss is 2.8608843417185783
loss with arrows pointing the opposite direction is 3.55585578507905
loss with arrows perpendicular to points 3.1845967027004645
optimal loss without distance kernel 2.6943469325594647
loss with arrows pointing the opposite direction (without distance kernel) is 4.679412457652052
loss with arrows perpendicular to points (without distance kernel) is  3.6259214477838198
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>How does this change with a larger batch size?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">64</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">FRED.datasets</span> <span class="kn">import</span> <span class="n">directed_circle</span><span class="p">,</span><span class="n">plot_directed_2d</span>
<span class="n">X</span><span class="p">,</span> <span class="n">flows</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">directed_circle</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="n">batch_size</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">flows</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">flows</span><span class="p">)</span>
<span class="n">plot_directed_2d</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">flows</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">arrow_scale</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">mask_prob</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_svg output_subarea ">
<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
  "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="269.722796pt" height="248.518125pt" viewBox="0 0 269.722796 248.518125" xmlns="http://www.w3.org/2000/svg" version="1.1">
 <metadata>
  <rdf:RDF xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
   <cc:Work>
    <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/>
    <dc:date>2022-12-24T05:53:26.931228</dc:date>
    <dc:format>image/svg+xml</dc:format>
    <dc:creator>
     <cc:Agent>
      <dc:title>Matplotlib v3.5.2, https://matplotlib.org/</dc:title>
     </cc:Agent>
    </dc:creator>
   </cc:Work>
  </rdf:RDF>
 </metadata>
 <defs>
  <style type="text/css">*{stroke-linejoin: round; stroke-linecap: butt}</style>
 </defs>
 <g id="figure_1">
  <g id="patch_1">
   <path d="M 0 248.518125 
L 269.722796 248.518125 
L 269.722796 0 
L 0 0 
L 0 248.518125 
z
" style="fill: none"/>
  </g>
  <g id="axes_1">
   <g id="patch_2">
    <path d="M 44.845313 224.64 
L 262.522796 224.64 
L 262.522796 7.2 
L 44.845313 7.2 
z
" style="fill: #ffffff"/>
   </g>
   <g id="PathCollection_1">
    <defs>
     <path id="C0_0_d274f17d69" d="M 0 1.5 
C 0.397805 1.5 0.77937 1.341951 1.06066 1.06066 
C 1.341951 0.77937 1.5 0.397805 1.5 -0 
C 1.5 -0.397805 1.341951 -0.77937 1.06066 -1.06066 
C 0.77937 -1.341951 0.397805 -1.5 0 -1.5 
C -0.397805 -1.5 -0.77937 -1.341951 -1.06066 -1.06066 
C -1.341951 -0.77937 -1.5 -0.397805 -1.5 0 
C -1.5 0.397805 -1.341951 0.77937 -1.06066 1.06066 
C -0.77937 1.341951 -0.397805 1.5 0 1.5 
z
"/>
    </defs>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="252.628365" y="113.933145" style="fill: #440154; stroke: #440154"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="252.482342" y="110.263692" style="fill: #440256; stroke: #440256"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="252.393725" y="108.906374" style="fill: #450457; stroke: #450457"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="251.98661" y="104.587392" style="fill: #450559; stroke: #450559"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="251.004902" y="98.058954" style="fill: #460a5d; stroke: #460a5d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="245.327632" y="78.670004" style="fill: #481769; stroke: #481769"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="242.700071" y="72.780854" style="fill: #481a6c; stroke: #481a6c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="240.368068" y="68.278051" style="fill: #481c6e; stroke: #481c6e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="238.488592" y="65.014496" style="fill: #481f70; stroke: #481f70"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="236.838693" y="62.366976" style="fill: #482071; stroke: #482071"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="235.905274" y="60.947348" style="fill: #482173; stroke: #482173"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="235.623753" y="60.529391" style="fill: #482173; stroke: #482173"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="235.390331" y="60.186294" style="fill: #482173; stroke: #482173"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="234.829594" y="59.374507" style="fill: #482374; stroke: #482374"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="232.409093" y="56.056263" style="fill: #482576; stroke: #482576"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="217.647236" y="40.508798" style="fill: #472f7d; stroke: #472f7d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="217.359551" y="40.266043" style="fill: #46307e; stroke: #46307e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="215.616545" y="38.834494" style="fill: #46327e; stroke: #46327e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="214.945977" y="38.301181" style="fill: #46327e; stroke: #46327e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="213.548912" y="37.219984" style="fill: #46337f; stroke: #46337f"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="202.779681" y="30.095971" style="fill: #443983; stroke: #443983"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="200.100514" y="28.619438" style="fill: #443a83; stroke: #443a83"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="194.061604" y="25.670291" style="fill: #433e85; stroke: #433e85"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="190.633654" y="24.21483" style="fill: #424086; stroke: #424086"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="184.441008" y="21.958505" style="fill: #414287; stroke: #414287"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="180.092391" y="20.645856" style="fill: #404588; stroke: #404588"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="175.60715" y="19.515668" style="fill: #3f4788; stroke: #3f4788"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="174.973967" y="19.373946" style="fill: #3f4889; stroke: #3f4889"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="171.993263" y="18.764921" style="fill: #3e4989; stroke: #3e4989"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="166.69037" y="17.914334" style="fill: #3e4c8a; stroke: #3e4c8a"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="163.37953" y="17.531649" style="fill: #3d4d8a; stroke: #3d4d8a"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="157.367447" y="17.123448" style="fill: #3c508b; stroke: #3c508b"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="156.49419" y="17.094678" style="fill: #3c508b; stroke: #3c508b"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="156.076167" y="17.083636" style="fill: #3c508b; stroke: #3c508b"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="149.686014" y="17.134706" style="fill: #3a538b; stroke: #3a538b"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="149.500885" y="17.14234" style="fill: #3a538b; stroke: #3a538b"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="148.552304" y="17.186907" style="fill: #3a548c; stroke: #3a548c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="146.614009" y="17.30637" style="fill: #3a548c; stroke: #3a548c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="146.349408" y="17.325642" style="fill: #39558c; stroke: #39558c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="138.744432" y="18.186507" style="fill: #38598c; stroke: #38598c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="137.452988" y="18.392265" style="fill: #38598c; stroke: #38598c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="135.293748" y="18.775553" style="fill: #375a8c; stroke: #375a8c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="133.134216" y="19.20856" style="fill: #375b8d; stroke: #375b8d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="129.388239" y="20.079497" style="fill: #365d8d; stroke: #365d8d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="129.278351" y="20.107374" style="fill: #365d8d; stroke: #365d8d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="127.798569" y="20.495873" style="fill: #365d8d; stroke: #365d8d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="125.454846" y="21.161659" style="fill: #355e8d; stroke: #355e8d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="123.584784" y="21.738036" style="fill: #355f8d; stroke: #355f8d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="119.610295" y="23.099773" style="fill: #34618d; stroke: #34618d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="117.744024" y="23.805202" style="fill: #33628d; stroke: #33628d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="115.434032" y="24.738717" style="fill: #33638d; stroke: #33638d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="112.755242" y="25.907477" style="fill: #32648e; stroke: #32648e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="109.308185" y="27.553362" style="fill: #31668e; stroke: #31668e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="109.012353" y="27.702311" style="fill: #31668e; stroke: #31668e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="106.426584" y="29.0579" style="fill: #31678e; stroke: #31678e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="106.075747" y="29.249393" style="fill: #31678e; stroke: #31678e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="103.964743" y="30.441011" style="fill: #31688e; stroke: #31688e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="102.773759" y="31.143834" style="fill: #30698e; stroke: #30698e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="101.096193" y="32.172474" style="fill: #306a8e; stroke: #306a8e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="99.311185" y="33.318388" style="fill: #2f6b8e; stroke: #2f6b8e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="92.016949" y="38.602588" style="fill: #2e6e8e; stroke: #2e6e8e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="84.517694" y="45.219824" style="fill: #2c718e; stroke: #2c718e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="80.085682" y="49.837199" style="fill: #2b748e; stroke: #2b748e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="78.686625" y="51.426297" style="fill: #2b758e; stroke: #2b758e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="78.378771" y="51.785334" style="fill: #2b758e; stroke: #2b758e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="77.021601" y="53.410709" style="fill: #2a768e; stroke: #2a768e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="75.976572" y="54.712063" style="fill: #2a778e; stroke: #2a778e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="73.445163" y="58.063218" style="fill: #29798e; stroke: #29798e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="66.443088" y="69.257246" style="fill: #277e8e; stroke: #277e8e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="60.029397" y="83.97161" style="fill: #25848e; stroke: #25848e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="56.458982" y="97.418172" style="fill: #238a8d; stroke: #238a8d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="55.012539" y="108.082984" style="fill: #218e8d; stroke: #218e8d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="55.001005" y="108.227435" style="fill: #218e8d; stroke: #218e8d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="54.739744" y="119.084126" style="fill: #20928c; stroke: #20928c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="54.794627" y="120.523763" style="fill: #20928c; stroke: #20928c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="55.083449" y="124.819502" style="fill: #1f948c; stroke: #1f948c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="55.103572" y="125.042445" style="fill: #1f948c; stroke: #1f948c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="56.427166" y="134.481688" style="fill: #1f988b; stroke: #1f988b"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="56.463226" y="134.67076" style="fill: #1f988b; stroke: #1f988b"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="57.218849" y="138.252446" style="fill: #1f9a8a; stroke: #1f9a8a"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="57.61884" y="139.922448" style="fill: #1f9a8a; stroke: #1f9a8a"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="58.136408" y="141.914793" style="fill: #1e9b8a; stroke: #1e9b8a"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="58.561586" y="143.436039" style="fill: #1e9c89; stroke: #1e9c89"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="61.83896" y="152.960167" style="fill: #1fa088; stroke: #1fa088"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="63.318043" y="156.444473" style="fill: #1fa187; stroke: #1fa187"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="63.450336" y="156.73897" style="fill: #1fa187; stroke: #1fa187"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="69.217593" y="167.65066" style="fill: #21a685; stroke: #21a685"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="72.761166" y="173.045004" style="fill: #23a983; stroke: #23a983"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="80.332833" y="182.503301" style="fill: #27ad81; stroke: #27ad81"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="80.590899" y="182.78693" style="fill: #27ad81; stroke: #27ad81"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="90.924645" y="192.58171" style="fill: #2eb37c; stroke: #2eb37c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="93.842332" y="194.883151" style="fill: #2fb47c; stroke: #2fb47c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="95.753693" y="196.297595" style="fill: #31b57b; stroke: #31b57b"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="104.875941" y="202.148497" style="fill: #38b977; stroke: #38b977"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="106.741924" y="203.179439" style="fill: #3aba76; stroke: #3aba76"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="108.991348" y="204.35385" style="fill: #3bbb75; stroke: #3bbb75"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="116.671797" y="207.836683" style="fill: #40bd72; stroke: #40bd72"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="132.567235" y="212.736226" style="fill: #4ec36b; stroke: #4ec36b"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="140.261252" y="214.099676" style="fill: #56c667; stroke: #56c667"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="143.19548" y="214.456382" style="fill: #58c765; stroke: #58c765"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="144.067028" y="214.545251" style="fill: #58c765; stroke: #58c765"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="145.126873" y="214.642834" style="fill: #5ac864; stroke: #5ac864"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="160.785802" y="214.756364" style="fill: #67cc5c; stroke: #67cc5c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="161.076419" y="214.734991" style="fill: #67cc5c; stroke: #67cc5c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="162.318511" y="214.633941" style="fill: #69cd5b; stroke: #69cd5b"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="166.291105" y="214.2046" style="fill: #6ece58; stroke: #6ece58"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="172.792163" y="213.147979" style="fill: #73d056; stroke: #73d056"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="180.207974" y="211.388838" style="fill: #7ad151; stroke: #7ad151"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="185.002007" y="209.922937" style="fill: #81d34d; stroke: #81d34d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="191.40983" y="207.535677" style="fill: #86d549; stroke: #86d549"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="199.635195" y="203.692912" style="fill: #90d743; stroke: #90d743"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="206.401529" y="199.797342" style="fill: #98d83e; stroke: #98d83e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="213.305002" y="195.031513" style="fill: #a2da37; stroke: #a2da37"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="222.429596" y="187.231603" style="fill: #b0dd2f; stroke: #b0dd2f"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="224.248038" y="185.429458" style="fill: #b2dd2d; stroke: #b2dd2d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="226.662968" y="182.884781" style="fill: #b5de2b; stroke: #b5de2b"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="231.460912" y="177.235285" style="fill: #c0df25; stroke: #c0df25"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="237.576721" y="168.538445" style="fill: #cae11f; stroke: #cae11f"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="239.392389" y="165.518708" style="fill: #d0e11c; stroke: #d0e11c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="239.891725" y="164.643475" style="fill: #d0e11c; stroke: #d0e11c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="243.805893" y="156.931558" style="fill: #dae319; stroke: #dae319"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="243.816088" y="156.909084" style="fill: #dae319; stroke: #dae319"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="247.447648" y="147.702055" style="fill: #e5e419; stroke: #e5e419"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="247.530693" y="147.455075" style="fill: #e5e419; stroke: #e5e419"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="250.305879" y="137.44993" style="fill: #efe51c; stroke: #efe51c"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="250.672362" y="135.723595" style="fill: #f1e51d; stroke: #f1e51d"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="251.128468" y="133.325323" style="fill: #f4e61e; stroke: #f4e61e"/>
    </g>
    <g clip-path="url(#pd8669036c6)">
     <use xlink:href="#C0_0_d274f17d69" x="252.451034" y="122.316355" style="fill: #fde725; stroke: #fde725"/>
    </g>
   </g>
   <g id="Quiver_1">
    <path d="M 252.05129 113.945392 
L 251.584154 91.935505 
L 250.442253 92.537075 
L 252.050999 86.729585 
L 253.9047 92.463588 
L 252.738303 91.911009 
L 253.205439 113.920897 
L 252.05129 113.945392 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 251.906119 110.297338 
L 250.622826 88.319929 
L 249.504026 88.963445 
L 250.89623 83.100275 
L 252.961365 88.761566 
L 251.775272 88.252636 
L 253.058566 110.230045 
L 251.906119 110.297338 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 251.818018 108.947936 
L 250.232831 86.990237 
L 249.12298 87.649067 
L 250.434481 81.767318 
L 252.577218 87.399696 
L 251.384243 86.907113 
L 252.969431 108.864812 
L 251.818018 108.947936 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 251.413278 104.654141 
L 248.867466 82.786992 
L 247.78755 83.493821 
L 248.840062 77.560254 
L 251.227543 83.093331 
L 250.01413 82.653495 
L 252.559943 104.520644 
L 251.413278 104.654141 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 250.437294 98.163773 
L 246.43943 76.514976 
L 245.409035 77.292222 
L 246.063662 71.301691 
L 248.814679 76.663305 
L 247.574645 76.305337 
L 251.572509 97.954134 
L 250.437294 98.163773 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 244.793133 78.887892 
L 236.48279 58.501829 
L 235.631678 59.472105 
L 235.056298 53.473443 
L 238.838677 58.164777 
L 237.551789 58.066053 
L 245.862132 78.452116 
L 244.793133 78.887892 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 242.180894 73.033085 
L 232.560689 53.231443 
L 231.774567 54.255082 
L 230.809787 48.30662 
L 234.889628 52.741696 
L 233.599043 52.726981 
L 243.219248 72.528623 
L 242.180894 73.033085 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 239.862491 68.55654 
L 229.240775 49.273581 
L 228.50811 50.336138 
L 227.239947 44.444893 
L 231.541575 48.665201 
L 230.251931 48.716602 
L 240.873646 67.999561 
L 239.862491 68.55654 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 237.993975 65.312017 
L 226.646381 46.44709 
L 225.954668 47.536749 
L 224.463308 41.698013 
L 228.922372 45.751622 
L 227.635616 45.852047 
L 238.983209 64.716975 
L 237.993975 65.312017 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 236.353697 62.679936 
L 224.417244 44.181978 
L 223.760213 45.292895 
L 222.085596 39.504056 
L 226.670188 43.415132 
L 225.387236 43.556057 
L 237.323689 62.054015 
L 236.353697 62.679936 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 235.425722 61.268587 
L 223.173516 42.978239 
L 222.53565 44.10027 
L 220.761916 38.341028 
L 225.412965 42.172835 
L 224.132621 42.335761 
L 236.384827 60.626108 
L 235.425722 61.268587 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 235.145842 60.853068 
L 222.800674 42.625336 
L 222.168529 43.7506 
L 220.365497 38.000463 
L 225.035994 41.808541 
L 223.756496 41.977983 
L 236.101663 60.205715 
L 235.145842 60.853068 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 234.913782 60.511971 
L 222.492303 42.336157 
L 221.864881 43.464061 
L 220.037757 37.721534 
L 224.724178 41.509998 
L 223.445402 41.684803 
L 235.866881 59.860617 
L 234.913782 60.511971 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 234.356315 59.704918 
L 221.754278 41.653823 
L 221.138131 42.787925 
L 219.253856 37.063896 
L 223.977808 40.805457 
L 222.700838 40.993 
L 235.302874 59.044096 
L 234.356315 59.704918 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 231.949929 56.406025 
L 218.609851 38.893296 
L 218.041284 40.051984 
L 215.921158 34.411056 
L 220.796269 37.953412 
L 219.528179 38.193772 
L 232.868257 55.706501 
L 231.949929 56.406025 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 217.274157 40.949226 
L 200.476021 26.719821 
L 200.170291 27.973757 
L 196.885245 22.921681 
L 202.408765 25.331186 
L 201.222179 25.838964 
L 218.020315 40.068369 
L 217.274157 40.949226 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 216.98815 40.707887 
L 200.13602 26.542468 
L 199.835061 27.797558 
L 196.530825 22.758011 
L 202.063469 25.146494 
L 200.878823 25.65878 
L 217.730952 39.824199 
L 216.98815 40.707887 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 215.255308 39.284686 
L 198.084774 25.506946 
L 197.812492 26.768567 
L 194.394281 21.805622 
L 199.979914 24.067414 
L 198.807248 24.606562 
L 215.977782 38.384302 
L 215.255308 39.284686 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 214.588651 38.754483 
L 197.299497 25.12589 
L 197.038147 26.389821 
L 193.577103 21.45665 
L 199.182105 23.670008 
L 198.01415 24.219286 
L 215.303303 37.847878 
L 214.588651 38.754483 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 213.199732 37.679591 
L 195.6701 24.361733 
L 195.431349 25.630127 
L 191.882813 20.759512 
L 197.526425 22.872483 
L 196.368459 23.442519 
L 213.898091 36.760377 
L 213.199732 37.679591 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 202.493303 30.597123 
L 183.379152 19.674551 
L 183.307548 20.963232 
L 179.155164 16.596 
L 185.025814 17.956322 
L 183.951907 18.672247 
L 203.066058 29.594819 
L 202.493303 30.597123 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 199.82976 29.1292 
L 180.387199 18.802526 
L 180.355454 20.092805 
L 176.070093 15.85598 
L 181.979977 17.034231 
L 180.928707 17.783002 
L 200.371268 28.109675 
L 199.82976 29.1292 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 193.826067 26.197251 
L 173.727558 17.213749 
L 173.783444 18.503207 
L 169.220452 14.566952 
L 175.196668 15.341445 
L 174.198633 16.159828 
L 194.297141 25.143331 
L 193.826067 26.197251 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 190.418107 24.750278 
L 169.995876 16.529218 
L 170.10023 17.815661 
L 165.392391 14.053847 
L 171.393512 14.602972 
L 170.42697 15.458321 
L 190.849201 23.679382 
L 190.418107 24.750278 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 184.261574 22.507111 
L 163.337492 15.663416 
L 163.52723 16.940062 
L 158.579472 13.499903 
L 164.603834 13.648426 
L 163.69636 14.566204 
L 184.620442 21.409899 
L 184.261574 22.507111 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 179.938316 21.202117 
L 158.722276 15.325639 
L 158.970387 16.592235 
L 153.870003 13.382706 
L 159.894835 13.25467 
L 159.030425 14.213117 
L 180.246465 20.089596 
L 179.938316 21.202117 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 175.479231 20.07852 
L 154.011815 15.199646 
L 154.318829 16.453268 
L 149.074069 13.485527 
L 155.086341 13.076158 
L 154.267652 14.073943 
L 175.735068 18.952817 
L 175.479231 20.07852 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 174.84974 19.937625 
L 153.350803 15.199583 
L 153.666029 16.451165 
L 148.401926 13.51787 
L 154.411385 13.069097 
L 153.599255 14.072227 
L 175.098193 18.810268 
L 174.84974 19.937625 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 171.886419 19.332151 
L 150.252022 15.257076 
L 150.605564 16.498379 
L 145.253799 13.728251 
L 151.246628 13.095001 
L 150.46571 14.122616 
L 172.100107 18.197691 
L 171.886419 19.332151 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 166.61445 18.486524 
L 144.790867 15.590916 
L 145.211217 16.811215 
L 139.717077 14.335449 
L 145.666735 13.378075 
L 144.942706 14.446536 
L 166.76629 17.342144 
L 166.61445 18.486524 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 163.322918 18.10607 
L 141.414217 15.946857 
L 141.875414 17.152312 
L 136.301035 14.862926 
L 142.215087 13.705783 
L 141.527442 14.798014 
L 163.436142 16.957227 
L 163.322918 18.10607 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 157.345894 17.70025 
L 135.346402 16.878241 
L 135.8801 18.053397 
L 130.176736 16.107469 
L 136.009413 14.592584 
L 135.389507 15.724636 
L 157.388999 16.546646 
L 157.345894 17.70025 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 156.47773 17.671648 
L 134.471839 17.043868 
L 135.01589 18.214267 
L 129.29557 16.31876 
L 135.114648 14.752448 
L 134.504759 15.889928 
L 156.51065 16.517708 
L 156.47773 17.671648 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 156.062145 17.660671 
L 134.053798 17.125867 
L 134.602788 18.293957 
L 128.874512 16.422635 
L 134.68692 14.831752 
L 134.081842 15.971798 
L 156.090189 16.506602 
L 156.062145 17.660671 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 149.709257 17.711442 
L 127.712269 18.597933 
L 128.335491 19.728163 
L 122.498398 18.230381 
L 128.196034 16.267744 
L 127.665783 17.44446 
L 149.662772 16.557969 
L 149.709257 17.711442 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 149.525207 17.719032 
L 127.529917 18.646699 
L 128.155254 19.77576 
L 122.315367 18.288908 
L 128.009319 16.315609 
L 127.481272 17.493315 
L 149.476562 16.565648 
L 149.525207 17.719032 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 148.582158 17.763339 
L 126.59678 18.901988 
L 127.232921 20.024998 
L 121.379038 18.594243 
L 127.053796 16.566406 
L 126.537072 17.749124 
L 148.52245 16.610475 
L 148.582158 17.763339 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 146.655167 17.882105 
L 124.69636 19.451869 
L 125.35441 20.562182 
L 119.473584 19.246551 
L 125.107466 17.10777 
L 124.614045 18.300398 
L 146.572852 16.730634 
L 146.655167 17.882105 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 146.392108 17.901265 
L 124.437588 19.529881 
L 125.098612 20.638427 
L 119.214281 19.338563 
L 124.842409 17.184689 
L 124.352187 18.378635 
L 146.306707 16.750019 
L 146.392108 17.901265 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 138.831482 18.75711 
L 117.068435 22.077221 
L 117.813137 23.131377 
L 111.84596 22.290064 
L 117.290839 19.70776 
L 116.894336 20.936015 
L 138.657383 17.615905 
L 138.831482 18.75711 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 137.547569 18.961668 
L 115.830286 22.569021 
L 116.58885 23.613246 
L 110.61108 22.850845 
L 116.021366 20.196829 
L 115.641125 21.430215 
L 137.358407 17.822863 
L 137.547569 18.961668 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 135.40092 19.342721 
L 113.768888 23.430331 
L 114.550401 24.457494 
L 108.557207 23.827716 
L 113.907366 21.054488 
L 113.554543 22.295996 
L 135.186575 18.208386 
L 135.40092 19.342721 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 133.253982 19.773203 
L 111.718259 24.341134 
L 112.522434 25.350653 
L 106.51671 24.854386 
L 111.803837 21.962798 
L 111.478727 23.211849 
L 133.01445 18.643917 
L 133.253982 19.773203 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 129.52985 20.63906 
L 108.187841 26.04017 
L 109.030626 27.017686 
L 103.010157 26.755106 
L 108.18096 23.660304 
L 107.904619 24.921043 
L 129.246628 19.519933 
L 129.52985 20.63906 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 129.420603 20.666775 
L 108.084794 26.092325 
L 108.928698 27.068876 
L 102.907932 26.813191 
L 108.075187 23.712469 
L 107.80029 24.973523 
L 129.136099 19.547973 
L 129.420603 20.666775 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 127.94945 21.053008 
L 106.700051 26.807691 
L 107.558949 27.771081 
L 101.53495 27.608488 
L 106.653661 24.428268 
L 106.398288 25.69342 
L 127.647688 19.938737 
L 127.94945 21.053008 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 125.619395 21.714912 
L 104.518079 27.990884 
L 105.40043 28.932841 
L 99.374254 28.918572 
L 104.413136 25.613324 
L 104.188981 26.884378 
L 125.290297 20.608406 
L 125.619395 21.714912 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 123.760239 22.287928 
L 102.78712 28.979838 
L 103.687921 29.904167 
L 97.66264 30.009036 
L 102.635194 26.604817 
L 102.436211 27.880055 
L 123.40933 21.188144 
L 123.760239 22.287928 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 119.808927 23.641724 
L 99.138685 31.217638 
L 100.0779 32.102907 
L 94.062498 32.463376 
L 98.886108 28.851204 
L 98.741421 30.133737 
L 119.411663 22.557823 
L 119.808927 23.641724 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 117.953539 24.343039 
L 97.440199 32.334048 
L 98.397066 33.200207 
L 92.390152 33.681849 
L 97.139975 29.973186 
L 97.021168 31.258375 
L 117.534509 23.267366 
L 117.953539 24.343039 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 115.657018 25.27111 
L 95.35131 33.775906 
L 96.329675 34.617706 
L 90.336787 35.25039 
L 94.991758 31.423348 
L 94.905337 32.71112 
L 115.211046 24.206324 
L 115.657018 25.27111 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 112.99385 26.433055 
L 92.948096 35.533666 
L 93.950889 36.346212 
L 87.979293 37.155559 
L 92.519242 33.192749 
L 92.470881 34.482511 
L 112.516634 25.3819 
L 112.99385 26.433055 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 109.566894 28.069342 
L 89.887217 37.936645 
L 90.920616 38.709894 
L 84.984696 39.749053 
L 89.368358 35.614019 
L 89.369798 36.904687 
L 109.049475 27.037383 
L 109.566894 28.069342 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 109.272787 28.217422 
L 89.62624 38.150524 
L 90.66222 38.92031 
L 84.72981 39.979327 
L 89.099611 35.829647 
L 89.10537 37.120303 
L 108.751918 27.187201 
L 109.272787 28.217422 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 106.702098 29.565105 
L 87.357059 40.073333 
L 88.415292 40.81223 
L 82.516698 42.045754 
L 86.762208 37.768998 
L 86.806031 39.058922 
L 106.15107 28.550695 
L 106.702098 29.565105 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 106.353307 29.755481 
L 87.050861 40.341742 
L 88.112069 41.076359 
L 82.218504 42.333692 
L 86.44671 38.039827 
L 86.495741 39.329565 
L 105.798188 28.743304 
L 106.353307 29.755481 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 104.254614 30.94015 
L 85.217206 41.995939 
L 86.296086 42.704348 
L 80.43508 44.105633 
L 84.556864 39.70951 
L 84.637465 40.99766 
L 103.674873 29.941871 
L 104.254614 30.94015 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 103.070575 31.638875 
L 84.189489 42.959562 
L 85.278162 43.652828 
L 79.437305 45.135863 
L 83.497267 40.682582 
L 83.595858 41.96948 
L 102.476944 30.648793 
L 103.070575 31.638875 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 101.402792 32.661517 
L 82.750495 44.355327 
L 83.852735 45.026813 
L 78.042515 46.625672 
L 82.013143 42.092559 
L 82.137298 43.377242 
L 100.789595 31.683432 
L 101.402792 32.661517 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 99.628193 33.800748 
L 81.23077 45.891579 
L 82.347146 46.53929 
L 76.572523 48.262291 
L 80.445097 43.645131 
L 80.596753 44.926859 
L 98.994177 32.836028 
L 99.628193 33.800748 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 92.376494 39.054133 
L 75.154379 52.767343 
L 76.325014 53.310887 
L 70.730933 55.551704 
L 74.167744 50.60162 
L 74.435289 51.864254 
L 91.657404 38.151044 
L 92.376494 39.054133 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 84.920972 45.632779 
L 69.170659 61.013969 
L 70.39017 61.436603 
L 65.050781 64.230512 
L 67.970504 58.958869 
L 68.364104 60.188058 
L 84.114417 44.806868 
L 84.920972 45.632779 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 80.514805 50.223228 
L 65.791486 66.590183 
L 67.035762 66.933118 
L 61.888102 70.066264 
L 64.461022 64.616944 
L 64.93324 65.818125 
L 79.656558 49.45117 
L 80.514805 50.223228 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 79.123907 51.803059 
L 64.754035 68.481192 
L 66.005361 68.797434 
L 60.925895 72.039968 
L 63.381669 66.536862 
L 63.879471 67.727668 
L 78.249343 51.049535 
L 79.123907 51.803059 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 78.817848 52.160002 
L 64.527832 68.906608 
L 65.780655 69.216867 
L 60.716741 72.483635 
L 63.146191 66.968858 
L 63.649678 68.157271 
L 77.939694 51.410666 
L 78.817848 52.160002 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 77.468592 53.775898 
L 63.540091 70.824365 
L 64.799265 71.107753 
L 59.806392 74.482101 
L 62.117314 68.916615 
L 62.646108 70.093986 
L 76.574609 53.045519 
L 77.468592 53.775898 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 76.429658 55.069664 
L 62.790604 72.350566 
L 64.054376 72.612681 
L 59.119111 76.070738 
L 61.335861 70.467077 
L 61.884432 71.635364 
L 75.523486 54.354463 
L 76.429658 55.069664 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 73.913011 58.401276 
L 61.019319 76.245212 
L 62.293073 76.45348 
L 57.508947 80.117786 
L 59.485985 74.425131 
L 60.083623 75.569095 
L 72.977315 57.725159 
L 73.913011 58.401276 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 66.951769 69.530025 
L 56.547846 88.931359 
L 57.837988 88.968236 
L 53.584152 93.236711 
L 54.7859 87.331561 
L 55.530484 88.3858 
L 65.934407 68.984467 
L 66.951769 69.530025 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 60.57548 84.158581 
L 53.444317 104.986444 
L 54.723455 104.814303 
L 51.215494 109.714223 
L 51.446955 103.692477 
L 52.352151 104.612502 
L 59.483314 83.784639 
L 60.57548 84.158581 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 57.025887 97.526728 
L 52.8855 119.148721 
L 54.127865 118.798929 
L 51.341589 124.142305 
L 50.726439 118.147591 
L 51.751691 118.931608 
L 55.892078 97.309616 
L 57.025887 97.526728 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 55.587879 108.129347 
L 53.819554 130.073057 
L 55.016596 129.590444 
L 52.826943 135.204749 
L 51.564559 129.312263 
L 52.668875 129.98033 
L 54.4372 108.03662 
L 55.587879 108.129347 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 55.576412 108.272956 
L 53.840216 130.219231 
L 55.03655 129.734866 
L 52.855119 135.352371 
L 51.58411 129.46174 
L 52.689402 130.128189 
L 54.425598 108.181914 
L 55.576412 108.272956 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 55.316674 119.066335 
L 55.995216 141.07072 
L 57.131286 140.458208 
L 55.578402 146.280883 
L 53.669704 140.564952 
L 54.841356 141.106301 
L 54.162813 119.101916 
L 55.316674 119.066335 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 55.371237 120.497577 
L 56.369983 142.489754 
L 57.497018 141.860772 
L 56.029047 147.705433 
L 54.037356 142.017888 
L 55.216762 142.542126 
L 54.218017 120.549949 
L 55.371237 120.497577 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 55.658375 124.768265 
L 57.612576 146.696203 
L 58.711191 146.018803 
L 57.498783 151.921774 
L 55.261635 146.326225 
L 56.462724 146.798677 
L 54.508523 124.870739 
L 55.658375 124.768265 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 55.67838 124.989908 
L 57.682169 146.913371 
L 58.779249 146.233488 
L 57.580194 152.139186 
L 55.330397 146.54871 
L 56.532551 147.018445 
L 54.528763 125.094983 
L 55.67838 124.989908 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 56.994256 134.374105 
L 61.097516 156.003174 
L 62.124113 155.220918 
L 61.498671 161.214567 
L 58.721573 155.866416 
L 59.963336 156.21834 
L 55.860076 134.589271 
L 56.994256 134.374105 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 57.030106 134.562074 
L 61.175418 156.183123 
L 62.200492 155.398872 
L 61.586707 161.393726 
L 58.799214 156.050985 
L 60.041659 156.400494 
L 55.896346 134.779445 
L 57.030106 134.562074 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 57.781322 138.122874 
L 62.723271 159.575857 
L 63.718645 158.754239 
L 63.326949 164.767689 
L 60.343806 159.531674 
L 61.598324 159.835002 
L 56.656375 138.382019 
L 57.781322 138.122874 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 58.178981 139.783137 
L 63.492371 161.147154 
L 64.473341 160.308392 
L 64.18603 166.327731 
L 61.112497 161.144258 
L 62.372089 161.425777 
L 57.058699 140.061759 
L 58.178981 139.783137 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 58.693531 141.763863 
L 64.450057 163.012764 
L 65.413372 162.153782 
L 65.251301 168.177795 
L 62.070637 163.05936 
L 63.335812 163.314623 
L 57.579286 142.065723 
L 58.693531 141.763863 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 59.116229 143.276238 
L 65.21111 164.430571 
L 66.160594 163.556326 
L 66.094675 169.582158 
L 62.832737 164.515132 
L 64.101824 164.750173 
L 58.006943 143.59584 
L 59.116229 143.276238 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 62.374491 152.744825 
L 70.587723 173.170206 
L 71.443442 172.203992 
L 71.990268 178.205324 
L 68.230258 173.496042 
L 69.516662 173.60089 
L 61.30343 153.175509 
L 62.374491 152.744825 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 63.844949 156.208812 
L 72.833158 176.305216 
L 73.651307 175.306989 
L 74.427199 181.283024 
L 70.489876 176.720954 
L 71.779347 176.776538 
L 62.791138 156.680134 
L 63.844949 156.208812 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 63.976469 156.501592 
L 73.03018 176.568572 
L 73.84507 175.567682 
L 74.64045 181.541154 
L 70.688267 176.991951 
L 71.977913 177.043328 
L 62.924202 156.976349 
L 63.976469 156.501592 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 69.710094 167.349649 
L 81.190777 186.133879 
L 81.874769 185.039356 
L 83.407371 190.867403 
L 78.91976 186.84542 
L 80.205774 186.7359 
L 68.725091 167.95167 
L 69.710094 167.349649 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 73.233002 172.712535 
L 85.913492 190.708606 
L 86.524697 189.571832 
L 88.433869 195.287605 
L 83.693676 191.566642 
L 84.969818 191.373542 
L 72.289329 173.377472 
L 73.233002 172.712535 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 80.760515 182.115676 
L 95.544713 198.42766 
L 96.012452 197.224728 
L 98.605658 202.664423 
L 93.44636 199.550479 
L 94.689349 199.20291 
L 79.905151 182.890926 
L 80.760515 182.115676 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 81.017077 182.39765 
L 95.864359 198.652236 
L 96.327434 197.447501 
L 98.941695 202.877109 
L 93.770372 199.783175 
L 95.012005 199.430794 
L 80.164722 183.176209 
L 81.017077 182.39765 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 91.29056 192.135312 
L 108.316392 206.091471 
L 108.601824 204.83276 
L 111.968062 209.831104 
L 106.406334 207.51115 
L 107.584562 206.984268 
L 90.55873 193.028108 
L 91.29056 192.135312 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 94.191232 194.423331 
L 111.728949 207.730541 
L 111.96693 206.462002 
L 115.518423 211.330462 
L 109.873529 209.220918 
L 111.031149 208.65018 
L 93.493431 195.34297 
L 94.191232 194.423331 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 96.091447 195.829527 
L 113.943764 208.711612 
L 114.151204 207.437723 
L 117.818621 212.219465 
L 112.124681 210.24613 
L 113.268257 209.647748 
L 95.41594 196.765662 
L 96.091447 195.829527 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 105.160498 201.646309 
L 124.31417 212.49943 
L 124.381095 211.210498 
L 128.549304 215.562628 
L 122.673755 214.223625 
L 123.745056 213.503806 
L 104.591385 202.650685 
L 105.160498 201.646309 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 107.015599 202.671239 
L 126.398572 213.109329 
L 126.437722 211.819254 
L 130.698696 216.080604 
L 124.795672 214.868453 
L 125.851222 214.125728 
L 106.468249 203.687639 
L 107.015599 202.671239 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 109.251905 203.838802 
L 128.89609 213.776576 
L 128.902156 212.485922 
L 133.27097 216.636641 
L 127.338812 215.576213 
L 128.374975 214.806673 
L 108.73079 204.868899 
L 109.251905 203.838802 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 116.887565 207.301324 
L 137.3064 215.530817 
L 137.202577 214.244331 
L 141.908863 218.008089 
L 135.907968 217.456485 
L 136.874863 216.601535 
L 116.456029 208.372042 
L 116.887565 207.301324 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 132.690307 212.172295 
L 154.198895 216.866334 
L 153.881109 215.615399 
L 159.151203 218.537917 
L 153.142674 218.998986 
L 153.95275 217.994196 
L 132.444162 213.300157 
L 132.690307 212.172295 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 140.339456 213.527794 
L 162.151302 216.510535 
L 161.735828 215.288566 
L 167.220037 217.786254 
L 161.266603 218.719859 
L 161.994893 217.654299 
L 140.183048 214.671559 
L 140.339456 213.527794 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 143.256573 213.88242 
L 165.147757 216.212531 
L 164.69598 215.003513 
L 170.252325 217.336329 
L 164.329423 218.447287 
L 165.025571 217.360456 
L 143.134387 215.030344 
L 143.256573 213.88242 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 144.123038 213.970771 
L 166.033988 216.107033 
L 165.571529 214.902061 
L 171.148304 217.185607 
L 165.235466 218.348945 
L 165.921968 217.255994 
L 144.011017 215.119732 
L 144.123038 213.970771 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 145.176703 214.067784 
L 167.109357 215.968316 
L 166.633967 214.768387 
L 172.234975 216.991834 
L 166.334989 218.218685 
L 167.009698 217.118415 
L 145.077043 215.217884 
L 145.176703 214.067784 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 160.744315 214.180652 
L 182.702221 212.598334 
L 182.043536 211.488397 
L 187.925114 212.800666 
L 182.292456 214.942667 
L 182.785195 213.749757 
L 160.827289 215.332075 
L 160.744315 214.180652 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 161.033238 214.159404 
L 182.98639 212.512447 
L 182.32444 211.404454 
L 188.209855 212.699402 
L 182.583528 214.857977 
L 183.072753 213.663621 
L 161.1196 215.310578 
L 161.033238 214.159404 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 162.268086 214.058943 
L 184.198763 212.13572 
L 183.522916 211.03615 
L 189.424168 212.256896 
L 183.825464 214.486136 
L 184.299613 213.285716 
L 162.368936 215.208938 
L 162.268086 214.058943 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 166.217514 213.632106 
L 188.052697 210.825301 
L 187.33302 209.753904 
L 193.278735 210.735474 
L 187.774568 213.188869 
L 188.199879 211.970289 
L 166.364696 214.777094 
L 166.217514 213.632106 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 172.68066 212.581647 
L 194.28083 208.328881 
L 193.491492 207.307719 
L 199.489324 207.891689 
L 194.160509 210.705713 
L 194.503836 209.461546 
L 172.903666 213.714312 
L 172.68066 212.581647 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 180.053225 210.832765 
L 201.262128 204.930578 
L 200.396556 203.97318 
L 206.42154 204.093914 
L 201.325049 207.309622 
L 201.571625 206.042726 
L 180.362722 211.944912 
L 180.053225 210.832765 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 184.819302 209.375412 
L 205.70216 202.406939 
L 204.789223 201.494594 
L 210.812592 201.310115 
L 205.885457 204.779746 
L 206.067571 203.50199 
L 185.184713 210.470462 
L 184.819302 209.375412 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 191.189757 207.002073 
L 211.541641 198.608377 
L 210.567891 197.761243 
L 216.564148 197.16132 
L 211.888331 200.962865 
L 211.981788 199.675584 
L 191.629903 208.06928 
L 191.189757 207.002073 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 199.367155 203.181718 
L 218.864334 192.95854 
L 217.817059 192.204192 
L 223.733122 191.057372 
L 219.425301 195.271357 
L 219.400415 193.980929 
L 199.903235 204.204106 
L 199.367155 203.181718 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 206.09403 199.308865 
L 224.724759 187.580723 
L 223.621284 186.911268 
L 229.428549 185.301711 
L 225.466277 189.842129 
L 225.339756 188.557677 
L 206.709027 200.285818 
L 206.09403 199.308865 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 212.957245 194.570829 
L 230.527961 181.307221 
L 229.371762 180.733609 
L 235.021879 178.638093 
L 231.458304 183.497716 
L 231.223475 182.22859 
L 213.652759 195.492198 
L 212.957245 194.570829 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 222.028628 186.816404 
L 237.864493 171.52331 
L 236.647359 171.09388 
L 242.002249 168.329798 
L 239.053166 173.585072 
L 238.666429 172.353707 
L 222.830564 187.646802 
L 222.028628 186.816404 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 223.836466 185.024769 
L 239.271498 169.327217 
L 238.043665 168.929411 
L 243.325274 166.027756 
L 240.513098 171.357547 
L 240.094643 170.136596 
L 224.65961 185.834147 
L 223.836466 185.024769 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 226.237313 182.494931 
L 241.10636 166.260252 
L 239.8652 165.906208 
L 245.040663 162.819206 
L 242.41913 168.245306 
L 241.95767 167.039952 
L 227.088623 183.274631 
L 226.237313 182.494931 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 231.007277 176.878381 
L 244.619767 159.576546 
L 243.355593 159.316372 
L 248.28554 155.850737 
L 246.077402 161.457798 
L 245.527036 160.290354 
L 231.914547 177.592189 
L 231.007277 176.878381 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 237.087421 168.232257 
L 248.765564 149.570147 
L 247.480777 149.447071 
L 252.010554 145.472638 
L 250.416575 151.284198 
L 249.744163 150.182523 
L 238.06602 168.844633 
L 237.087421 168.232257 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 238.892501 165.23013 
L 249.898996 146.164181 
L 248.610642 146.086913 
L 252.996086 141.953768 
L 251.609969 147.818381 
L 250.898772 146.741337 
L 239.892277 165.807286 
L 238.892501 165.23013 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 239.388925 164.360001 
L 250.200752 145.18299 
L 248.911678 145.118842 
L 253.254818 140.941266 
L 251.928477 146.819686 
L 251.206351 145.749938 
L 240.394525 164.926949 
L 239.388925 164.360001 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 243.280268 156.693057 
L 252.376814 136.645459 
L 251.087062 136.694082 
L 255.048951 132.153329 
L 254.240815 138.125089 
L 253.428065 137.122461 
L 244.331519 157.17006 
L 243.280268 156.693057 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 243.290403 156.670713 
L 252.38195 136.620847 
L 251.09221 136.669792 
L 255.052967 132.128052 
L 254.24632 138.100013 
L 253.43332 137.097588 
L 244.341773 157.147454 
L 243.290403 156.670713 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 246.900785 147.517377 
L 253.944511 126.659781 
L 252.666107 126.837287 
L 256.153481 121.922694 
L 255.947284 127.945358 
L 255.038237 127.029138 
L 247.994511 147.886734 
L 246.900785 147.517377 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 246.983346 147.271837 
L 253.972138 126.39577 
L 252.694206 126.576641 
L 256.16863 121.652885 
L 255.978288 127.676071 
L 255.066832 126.762247 
L 248.07804 147.638313 
L 246.983346 147.271837 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 249.742348 137.325037 
L 254.505802 115.831716 
L 253.253848 116.145462 
L 256.193364 110.884831 
L 256.635033 116.894817 
L 255.632863 116.081501 
L 250.86941 137.574822 
L 249.742348 137.325037 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 250.106694 135.60877 
L 254.486178 114.033935 
L 253.240016 114.369953 
L 256.085272 109.057748 
L 256.634025 115.058904 
L 255.617514 114.263586 
L 251.23803 135.83842 
L 250.106694 135.60877 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 250.56014 133.224484 
L 254.406202 111.548202 
L 253.168706 111.914851 
L 255.882084 106.534091 
L 256.578674 112.519888 
L 255.542857 111.749881 
L 251.696796 133.426163 
L 250.56014 133.224484 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
    <path d="M 251.874994 122.279715 
L 253.272447 100.309269 
L 252.083726 100.81203 
L 254.178244 95.161544 
L 255.539969 101.031868 
L 254.424528 100.382548 
L 253.027075 122.352994 
L 251.874994 122.279715 
" clip-path="url(#pd8669036c6)" style="fill-opacity: 0.1"/>
   </g>
   <g id="matplotlib.axis_1">
    <g id="xtick_1">
     <g id="line2d_1">
      <defs>
       <path id="m3ce948736c" d="M 0 0 
L 0 3.5 
" style="stroke: #000000; stroke-width: 0.8"/>
      </defs>
      <g>
       <use xlink:href="#m3ce948736c" x="54.692717" y="224.64" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_1">
      <!-- −1.0 -->
      <g transform="translate(42.551311 239.238437)scale(0.1 -0.1)">
       <defs>
        <path id="DejaVuSans-2212" d="M 678 2272 
L 4684 2272 
L 4684 1741 
L 678 1741 
L 678 2272 
z
" transform="scale(0.015625)"/>
        <path id="DejaVuSans-31" d="M 794 531 
L 1825 531 
L 1825 4091 
L 703 3866 
L 703 4441 
L 1819 4666 
L 2450 4666 
L 2450 531 
L 3481 531 
L 3481 0 
L 794 0 
L 794 531 
z
" transform="scale(0.015625)"/>
        <path id="DejaVuSans-2e" d="M 684 794 
L 1344 794 
L 1344 0 
L 684 0 
L 684 794 
z
" transform="scale(0.015625)"/>
        <path id="DejaVuSans-30" d="M 2034 4250 
Q 1547 4250 1301 3770 
Q 1056 3291 1056 2328 
Q 1056 1369 1301 889 
Q 1547 409 2034 409 
Q 2525 409 2770 889 
Q 3016 1369 3016 2328 
Q 3016 3291 2770 3770 
Q 2525 4250 2034 4250 
z
M 2034 4750 
Q 2819 4750 3233 4129 
Q 3647 3509 3647 2328 
Q 3647 1150 3233 529 
Q 2819 -91 2034 -91 
Q 1250 -91 836 529 
Q 422 1150 422 2328 
Q 422 3509 836 4129 
Q 1250 4750 2034 4750 
z
" transform="scale(0.015625)"/>
       </defs>
       <use xlink:href="#DejaVuSans-2212"/>
       <use xlink:href="#DejaVuSans-31" x="83.789062"/>
       <use xlink:href="#DejaVuSans-2e" x="147.412109"/>
       <use xlink:href="#DejaVuSans-30" x="179.199219"/>
      </g>
     </g>
    </g>
    <g id="xtick_2">
     <g id="line2d_2">
      <g>
       <use xlink:href="#m3ce948736c" x="104.182201" y="224.64" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_2">
      <!-- −0.5 -->
      <g transform="translate(92.040794 239.238437)scale(0.1 -0.1)">
       <defs>
        <path id="DejaVuSans-35" d="M 691 4666 
L 3169 4666 
L 3169 4134 
L 1269 4134 
L 1269 2991 
Q 1406 3038 1543 3061 
Q 1681 3084 1819 3084 
Q 2600 3084 3056 2656 
Q 3513 2228 3513 1497 
Q 3513 744 3044 326 
Q 2575 -91 1722 -91 
Q 1428 -91 1123 -41 
Q 819 9 494 109 
L 494 744 
Q 775 591 1075 516 
Q 1375 441 1709 441 
Q 2250 441 2565 725 
Q 2881 1009 2881 1497 
Q 2881 1984 2565 2268 
Q 2250 2553 1709 2553 
Q 1456 2553 1204 2497 
Q 953 2441 691 2322 
L 691 4666 
z
" transform="scale(0.015625)"/>
       </defs>
       <use xlink:href="#DejaVuSans-2212"/>
       <use xlink:href="#DejaVuSans-30" x="83.789062"/>
       <use xlink:href="#DejaVuSans-2e" x="147.412109"/>
       <use xlink:href="#DejaVuSans-35" x="179.199219"/>
      </g>
     </g>
    </g>
    <g id="xtick_3">
     <g id="line2d_3">
      <g>
       <use xlink:href="#m3ce948736c" x="153.671684" y="224.64" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_3">
      <!-- 0.0 -->
      <g transform="translate(145.720121 239.238437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-30"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-30" x="95.410156"/>
      </g>
     </g>
    </g>
    <g id="xtick_4">
     <g id="line2d_4">
      <g>
       <use xlink:href="#m3ce948736c" x="203.161167" y="224.64" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_4">
      <!-- 0.5 -->
      <g transform="translate(195.209604 239.238437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-30"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-35" x="95.410156"/>
      </g>
     </g>
    </g>
    <g id="xtick_5">
     <g id="line2d_5">
      <g>
       <use xlink:href="#m3ce948736c" x="252.65065" y="224.64" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_5">
      <!-- 1.0 -->
      <g transform="translate(244.699087 239.238437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-31"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-30" x="95.410156"/>
      </g>
     </g>
    </g>
   </g>
   <g id="matplotlib.axis_2">
    <g id="ytick_1">
     <g id="line2d_6">
      <defs>
       <path id="m746050a960" d="M 0 0 
L -3.5 0 
" style="stroke: #000000; stroke-width: 0.8"/>
      </defs>
      <g>
       <use xlink:href="#m746050a960" x="44.845313" y="215.012359" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_6">
      <!-- −1.00 -->
      <g transform="translate(7.2 218.811577)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-2212"/>
       <use xlink:href="#DejaVuSans-31" x="83.789062"/>
       <use xlink:href="#DejaVuSans-2e" x="147.412109"/>
       <use xlink:href="#DejaVuSans-30" x="179.199219"/>
       <use xlink:href="#DejaVuSans-30" x="242.822266"/>
      </g>
     </g>
    </g>
    <g id="ytick_2">
     <g id="line2d_7">
      <g>
       <use xlink:href="#m746050a960" x="44.845313" y="190.267617" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_7">
      <!-- −0.75 -->
      <g transform="translate(7.2 194.066836)scale(0.1 -0.1)">
       <defs>
        <path id="DejaVuSans-37" d="M 525 4666 
L 3525 4666 
L 3525 4397 
L 1831 0 
L 1172 0 
L 2766 4134 
L 525 4134 
L 525 4666 
z
" transform="scale(0.015625)"/>
       </defs>
       <use xlink:href="#DejaVuSans-2212"/>
       <use xlink:href="#DejaVuSans-30" x="83.789062"/>
       <use xlink:href="#DejaVuSans-2e" x="147.412109"/>
       <use xlink:href="#DejaVuSans-37" x="179.199219"/>
       <use xlink:href="#DejaVuSans-35" x="242.822266"/>
      </g>
     </g>
    </g>
    <g id="ytick_3">
     <g id="line2d_8">
      <g>
       <use xlink:href="#m746050a960" x="44.845313" y="165.522875" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_8">
      <!-- −0.50 -->
      <g transform="translate(7.2 169.322094)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-2212"/>
       <use xlink:href="#DejaVuSans-30" x="83.789062"/>
       <use xlink:href="#DejaVuSans-2e" x="147.412109"/>
       <use xlink:href="#DejaVuSans-35" x="179.199219"/>
       <use xlink:href="#DejaVuSans-30" x="242.822266"/>
      </g>
     </g>
    </g>
    <g id="ytick_4">
     <g id="line2d_9">
      <g>
       <use xlink:href="#m746050a960" x="44.845313" y="140.778134" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_9">
      <!-- −0.25 -->
      <g transform="translate(7.2 144.577353)scale(0.1 -0.1)">
       <defs>
        <path id="DejaVuSans-32" d="M 1228 531 
L 3431 531 
L 3431 0 
L 469 0 
L 469 531 
Q 828 903 1448 1529 
Q 2069 2156 2228 2338 
Q 2531 2678 2651 2914 
Q 2772 3150 2772 3378 
Q 2772 3750 2511 3984 
Q 2250 4219 1831 4219 
Q 1534 4219 1204 4116 
Q 875 4013 500 3803 
L 500 4441 
Q 881 4594 1212 4672 
Q 1544 4750 1819 4750 
Q 2544 4750 2975 4387 
Q 3406 4025 3406 3419 
Q 3406 3131 3298 2873 
Q 3191 2616 2906 2266 
Q 2828 2175 2409 1742 
Q 1991 1309 1228 531 
z
" transform="scale(0.015625)"/>
       </defs>
       <use xlink:href="#DejaVuSans-2212"/>
       <use xlink:href="#DejaVuSans-30" x="83.789062"/>
       <use xlink:href="#DejaVuSans-2e" x="147.412109"/>
       <use xlink:href="#DejaVuSans-32" x="179.199219"/>
       <use xlink:href="#DejaVuSans-35" x="242.822266"/>
      </g>
     </g>
    </g>
    <g id="ytick_5">
     <g id="line2d_10">
      <g>
       <use xlink:href="#m746050a960" x="44.845313" y="116.033392" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_10">
      <!-- 0.00 -->
      <g transform="translate(15.579688 119.832611)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-30"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-30" x="95.410156"/>
       <use xlink:href="#DejaVuSans-30" x="159.033203"/>
      </g>
     </g>
    </g>
    <g id="ytick_6">
     <g id="line2d_11">
      <g>
       <use xlink:href="#m746050a960" x="44.845313" y="91.288651" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_11">
      <!-- 0.25 -->
      <g transform="translate(15.579688 95.08787)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-30"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-32" x="95.410156"/>
       <use xlink:href="#DejaVuSans-35" x="159.033203"/>
      </g>
     </g>
    </g>
    <g id="ytick_7">
     <g id="line2d_12">
      <g>
       <use xlink:href="#m746050a960" x="44.845313" y="66.543909" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_12">
      <!-- 0.50 -->
      <g transform="translate(15.579688 70.343128)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-30"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-35" x="95.410156"/>
       <use xlink:href="#DejaVuSans-30" x="159.033203"/>
      </g>
     </g>
    </g>
    <g id="ytick_8">
     <g id="line2d_13">
      <g>
       <use xlink:href="#m746050a960" x="44.845313" y="41.799168" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_13">
      <!-- 0.75 -->
      <g transform="translate(15.579688 45.598386)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-30"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-37" x="95.410156"/>
       <use xlink:href="#DejaVuSans-35" x="159.033203"/>
      </g>
     </g>
    </g>
    <g id="ytick_9">
     <g id="line2d_14">
      <g>
       <use xlink:href="#m746050a960" x="44.845313" y="17.054426" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_14">
      <!-- 1.00 -->
      <g transform="translate(15.579688 20.853645)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-31"/>
       <use xlink:href="#DejaVuSans-2e" x="63.623047"/>
       <use xlink:href="#DejaVuSans-30" x="95.410156"/>
       <use xlink:href="#DejaVuSans-30" x="159.033203"/>
      </g>
     </g>
    </g>
   </g>
   <g id="patch_3">
    <path d="M 44.845313 224.64 
L 44.845313 7.2 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_4">
    <path d="M 262.522796 224.64 
L 262.522796 7.2 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_5">
    <path d="M 44.845313 224.64 
L 262.522796 224.64 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_6">
    <path d="M 44.845313 7.2 
L 262.522796 7.2 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
  </g>
 </g>
 <defs>
  <clipPath id="pd8669036c6">
   <rect x="44.845313" y="7.2" width="217.677483" height="217.44"/>
  </clipPath>
 </defs>
</svg>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">neighbors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">contrastive_flow_loss_V2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">flows</span><span class="p">,</span><span class="n">neighbors</span><span class="p">,</span><span class="n">use_distance_kernel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;optimal loss is&quot;</span><span class="p">,</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="n">neighbors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">contrastive_flow_loss_V2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="o">-</span><span class="n">flows</span><span class="p">,</span><span class="n">neighbors</span><span class="p">,</span><span class="n">use_distance_kernel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loss with arrows pointing the opposite direction is&quot;</span><span class="p">,</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="n">neighbors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="n">flows_t</span> <span class="o">=</span> <span class="n">flows</span>
<span class="n">flow_p</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">flows_t</span><span class="p">)</span>
<span class="n">flow_p</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">flows_t</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">flow_p</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">flows_t</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">flow_p</span> <span class="o">=</span> <span class="o">-</span><span class="n">flow_p</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">contrastive_flow_loss_V2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">flow_p</span><span class="p">,</span><span class="n">neighbors</span><span class="p">,</span><span class="n">use_distance_kernel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loss with arrows perpendicular to points&quot;</span><span class="p">,</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="n">neighbors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">contrastive_flow_loss_V2</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="n">flows</span><span class="p">,</span><span class="n">neighbors</span><span class="p">,</span><span class="n">use_distance_kernel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;optimal loss without distance kernel&quot;</span><span class="p">,</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="n">neighbors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">contrastive_flow_loss_V2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="o">-</span><span class="n">flows</span><span class="p">,</span><span class="n">neighbors</span><span class="p">,</span><span class="n">use_distance_kernel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loss with arrows pointing the opposite direction (without distance kernel) is&quot;</span><span class="p">,</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="n">neighbors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="n">flows_t</span> <span class="o">=</span> <span class="n">flows</span>
<span class="n">flow_p</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">flows_t</span><span class="p">)</span>
<span class="n">flow_p</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">flows_t</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">flow_p</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">flows_t</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">flow_p</span> <span class="o">=</span> <span class="o">-</span><span class="n">flow_p</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">contrastive_flow_loss_V2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">flow_p</span><span class="p">,</span><span class="n">neighbors</span><span class="p">,</span><span class="n">use_distance_kernel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loss with arrows perpendicular to points (without distance kernel) is &quot;</span><span class="p">,</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>optimal loss is 4.100853289227099
loss with arrows pointing the opposite direction is 4.9050499763904085
loss with arrows perpendicular to points 4.5102533231052435
optimal loss without distance kernel 4.189987862931081
loss with arrows pointing the opposite direction (without distance kernel) is 5.979923745412609
loss with arrows perpendicular to points (without distance kernel) is  4.981742533044305
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Even with very large batch sizes, the optimal loss is the lowest. The problem then seems to be that gradient information is not flowing through the loss function to the flow artist.</p>

</div>
</div>
</div>
</div>
 

